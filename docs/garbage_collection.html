<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Xdebug: Documentation Â» Garbage Collection Statistics</title>
	<meta name="ROBOTS" content="ALL" />
	<meta name="MSSmartTagsPreventParsing" content="true" />
	<meta name="DESCRIPTION" content="Xdebug: A powerful debugger for PHP" />
	<meta name="AUTHOR" content="Derick Rethans, as in derick@xdebug.org" />
	<link rel="icon" type="image/png" href="../images/favicon.png">
		<link rel="stylesheet" type="text/css" href="../core2.css" />
	<meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
</head>
<body>
	<nav>
	<div class="content_width">
		<h1><a href="../index.html"><svg xmlns="http://www.w3.org/2000/svg" width="351" height="181" viewBox="0 0 351 181"><title>Xdebug</title><g fill="none" fill-rule="evenodd" stroke="#FFF"><g transform="translate(5 5)"><path fill="#317E1E" fill-rule="nonzero" stroke-width="5" d="M127.9 85.5l68.2 70.7.4 17.3h-38.6l-60.8-59.7-60 59.7h-39v-17.6l69.7-69.8-69.6-71.2V-2.5h38.7l60.2 60 61-60h38.3v16l-68.5 72z"/><circle cx="75.9" cy="74.6" r="3.5" stroke-opacity=".8" stroke-width="4"/><circle cx="105.1" cy="85" r="3.5" stroke-opacity=".8" stroke-width="4"/><circle cx="158.4" cy="15" r="3.5" stroke-opacity=".8" stroke-width="4"/><circle cx="50.9" cy="140" r="3.5" stroke-opacity=".8" stroke-width="4"/><circle cx="180.4" cy="158.5" r="3.5" stroke-opacity=".8" stroke-width="4"/><path stroke-linecap="square" stroke-linejoin="round" stroke-width="4" d="M32.6 158.2L42 149M104.3 69.1l49.4-49.4"/><path stroke-linejoin="round" stroke-width="4" d="M102.3 82.7L30.3 10H11.2M167.4 10H183M11.2 160.7l79.2-78"/><path stroke-linejoin="round" stroke-opacity=".7" stroke-width="4" d="M116.3 74.6L181 10"/><path stroke-linejoin="round" stroke-width="4" d="M20.7 19.7l52.7 52.6"/><path stroke-linejoin="round" stroke-opacity=".7" stroke-width="4" d="M116.3 96.7l32 32"/><path stroke-linejoin="round" stroke-width="4" d="M155.2 133.6l22.1 22M53.6 137.5L97 94.9l67.1 66.6h4.9"/></g><g fill="#000" fill-rule="nonzero" stroke-width="4"><path d="M158.3 107.7V72.9c0-.5 0-.5-.8-.5-.7 0-.7 0-.7.6v34.7c0 .6 0 .5.7.5.8 0 .7 0 .7-.5zm3.9 11.2a22.5 22.5 0 0 1-20-.7c-3.4-2-5.2-4.8-5.2-8.4V69.6c0-3 1.5-5.6 4.3-7.4a17 17 0 0 1 9.2-2.4c3 0 5.6.3 7.7 1V47H178v73h-15l-.8-1.1zM200.9 84V73.2c0-.8 0-.8-.8-.8s-.8 0-.8.8V84h1.6zm-1.6 12.5v11c0 .7 0 .7.8.7.7 0 .8 0 .8-.8V97.2h19.8v10.4c0 8.9-7.3 13.2-20.7 13.2-13.3 0-20.5-4.5-20.5-13.7V73.6c0-9.2 7.2-13.8 20.5-13.8 13.4 0 20.7 4.4 20.7 13.4v23.3h-21.4zM243.3 107.7V73c0-.6 0-.6-.7-.6-.8 0-.8 0-.8.5v34.8c0 .6 0 .5.8.5.7 0 .7 0 .7-.5zm-5.4 11.1l-.9 1.3h-15V47h19.8v13.8c2.1-.7 4.7-1 7.9-1 3.1 0 6.1.8 8.8 2.3 3 1.6 4.6 4.2 4.6 7.5v40.2c0 3.6-1.8 6.4-5.3 8.4a22.5 22.5 0 0 1-19.9.6zM285.8 119.7c-2.1.8-4.7 1.1-7.8 1.1a17 17 0 0 1-9.1-2.4c-2.8-1.7-4.4-4.2-4.4-7.2v-51h19.8v47.5c0 .6 0 .5.8.5.7 0 .7 0 .7-.4V60h19.8v60h-19.8v-.4zM328.3 108.3V73c0-.6 0-.6-.7-.6-.8 0-.8 0-.8.6V108c0 .6 0 .6.8.6.7 0 .7 0 .7-.4zm-.9 11.8c-2 .5-4.2.7-6.9.7a17 17 0 0 1-9.1-2.4c-2.9-1.7-4.4-4.2-4.4-7.2V71c0-7.4 5.2-11.2 14.6-11.2 2.3 0 5 .7 8.3 2l1.7-1.7H348v57.3c0 4.4-1 9.5-2.8 12-2.1 3.2-7.7 4.5-17 4.5h-18.4v-12h14.9c1.1 0 2-.7 2.7-1.8z"/></g></g></svg>
</a></h1>
		<ul id="menu">
			<li><a href="install.html">Install</a></li>
			<li><a href="index.html">Documentation</a></li>
			<li><a href="../reporting-bugs.html">Report Issues</a></li>
			<li><a href="https://github.com/xdebug/xdebug" target="_blank">GitHub</a></li>
		</ul>
	</div>
</nav>
<div class="deprecated">
You're visiting the archived website and documentation of Xdebug 2, which is no longer supported. This website is temporarily available and will be discontinued on Dec 31st, 2021.
</div>

	<div class="content_width" id="support">If you find Xdebug useful, please consider <a href='../support.html'>supporting the project</a>.</div>

	<main class="content_width">
<h1>Garbage Collection Statistics</h1>

<div class="doc_section">
	<p class='intro'>Xdebug's built-in garbage collection statistics profiler allows you to
			find out when the PHP internal garbage collector triggers, how many variables
			it was able to clean up, how long it took, and how how much memory was actually freed.</p>
	<h2 name="introduction">Introduction</h2>

<p><i>New in Xdebug 2.6</i></p>

<p>Garbage Collection (GC) in PHP can have a serious impact on memory and performance,
so understanding when it is triggered and how efficient each run is, allows
you to optimise your programs. The PHP Engine does not provide a mechanism to
gather statistics about garbage collection, but Xdebug now does.</p>

<p>For the time being, the garbage collection statistics are collected in a human
readable, tabular format only, because there are no tools for this kind of report
that we could generate machine readable output for. Future versions may include
exports in other formats to allow machine processing.</p>

<h2 name="usage">Usage</h2>

<p>There are two approaches to start collecting the GC statistics with two different
use-cases.</p>

<h3 name="by-settings">By Settings</h3>
<p>The first is entirely via INI settings and the primary use-case is to
collect statistics for indiviual CLI script runs (where GC is often an issue).</p>

<p><code>php -dxdebug.gc_stats_enable=1 your_script.php</code></p>

<p>If you wish to collect the garbage collection statistics for every script
that you execute, you can set the <a href="all_settings.html#gc_stats_enable">xdebug.gc_stats_enable</a> INI setting on the system
or directory-level. Be aware that activating the collection globally will produce
an output file for <b>every</b> executed script, even if the garbage collector
didn't run.</p>

<h3 name="with-functions">By Calling a Function</h3>
<p>The second approach to starting collection is to call the function
<a href="all_functions.html#xdebug_start_gcstats">xdebug_start_gcstats()</a> directly in your PHP script. This gives you
more control over when statistics collection is started.</p>

<p>You can stop collection for both INI and function based approaches by
calling <a href="all_functions.html#xdebug_stop_gcstats">xdebug_stop_gcstats()</a>.</p>

<h2 name="output-tabular-text">Output</h2>

<p>The default (and only for now) output format of Garbage Collection statistics
is a tabular human readable text output.</p>

<p>The output format of Garbage Collection statistics is a tabular human
readable text output.</p>

<pre>
Garbage Collection Report
version: 1
creator: xdebug 2.6.0 (PHP 7.2.0)

Collected | Efficiency% | Duration | Memory Before | Memory After | Reduction% | Function
----------+-------------+----------+---------------+--------------+------------+---------
    10000 |    100.00 % |  0.00 ms |       5539880 |       579880 |    79.53 % | bar
    10000 |    100.00 % |  0.00 ms |       5540040 |       580040 |    79.53 % | Garbage::produce
     4001 |     40.01 % |  0.00 ms |       2563048 |       578968 |    77.41 % | gc_collect_cycles
</pre>

<p>The header contains the version of the report and the version of Xdebug that generated it.</p>

<p>The table itself then contains one row for each garbage collection run each with 7 reported variables:</p>

<ul>
	<li><strong>Collected</strong> &mdash; The number of so called "roots" that have been garbage collected during this run. A "root" is either an PHP object (instance) or an array that is under observation by the Garbage Collector for potential cleanup.</li>
	<li><strong>Efficiency%</strong> &mdash; Is the number of cleared roots divided by 10 000 - a magic number of "roots" when reached triggers PHPs internal garbage collector to run automatically.</li>
	<li><strong>Duration</strong> &mdash; Denotes the duration in milliseconds that this garbage collection run took.</li>
	<li><strong>Memory Before</strong> &mdash; Contains the memory as measured by <code>memory_get_usage()</code> before this GC run was activated.</li>
	<li><strong>Memory After</strong> &mdash; Contains the memory as measured by <code>memory_get_usage()</code> after the GC run was finished.</li>
	<li><strong>Reduction%</strong> &mdash; The percent reduction in memory due to this GC run.</li>
	<li><strong>Function</strong> &mdash; The name of the function or method the GC run was triggered in. If it is <code>gc_collect_cycles()</code> then this means the Garbage Collector was triggered explicitly. All other values indicate the GC was triggered implicitly due to the 10 000 "roots" reached metric of the PHP engine.</li>
</ul>

<p>For details on how PHPs garbage collection works see the <a
href="http://php.net/manual/en/features.gc.php">PHP manuals chapter on Garbage
Collection</a>.</p>

			<h2>Related Settings and Functions</h2>
		<ul>
							<li><span class='type'>bool</span> <a href='garbage_collection.html#gc_stats_enable'>xdebug.gc_stats_enable</a> = <span class='default'>false</span></li>
							<li><span class='type'>string</span> <a href='garbage_collection.html#gc_stats_output_dir'>xdebug.gc_stats_output_dir</a> = <span class='default'>/tmp</span></li>
							<li><span class='type'>string</span> <a href='garbage_collection.html#gc_stats_output_name'>xdebug.gc_stats_output_name</a> = <span class='default'>gcstats.%p</span></li>
					</ul>
		<ul>
							<li><a href='garbage_collection.html#xdebug_get_gc_run_count'><span class='name'>xdebug_get_gc_run_count</span></a>()<span class='type'> : int</span></li>
							<li><a href='garbage_collection.html#xdebug_get_gc_total_collected_roots'><span class='name'>xdebug_get_gc_total_collected_roots</span></a>()<span class='type'> : int</span></li>
							<li><a href='garbage_collection.html#xdebug_get_gcstats_filename'><span class='name'>xdebug_get_gcstats_filename</span></a>()<span class='type'> : mixed</span></li>
							<li><a href='garbage_collection.html#xdebug_start_gcstats'><span class='name'>xdebug_start_gcstats</span></a>()<span class='type'> : mixed</span></li>
							<li><a href='garbage_collection.html#xdebug_stop_gcstats'><span class='name'>xdebug_stop_gcstats</span></a>()<span class='type'> : string</span></li>
					</ul>
	
	<a name='settings'></a>
			<div class='settings'>
			<h3>Settings</h3>

							<hr>
				<div class="doc_setting">
	<a name='gc_stats_enable'></a>
	<a name='xdebug.gc_stats_enable'></a>
	<h4><span class='type'>bool</span> xdebug.gc_stats_enable = <span class='default'>false</span> <a href='garbage_collection.html#gc_stats_enable'>#</a></h4>

	<p>Introduced in <span class='type'>Xdebug >= 2.6</span></p>	
	<div class='description'><p>If this setting is enabled, then statistics for garbage collection runs
are automatically collected into the given directory set with <a href="all_settings.html#gc_stats_output_dir">xdebug.gc_stats_output_dir</a>
and with an automatically generated name configured by <a href="all_settings.html#gc_stats_output_name">xdebug.gc_stats_output_name</a>.</p>
</div>
</div>
							<hr>
				<div class="doc_setting">
	<a name='gc_stats_output_dir'></a>
	<a name='xdebug.gc_stats_output_dir'></a>
	<h4><span class='type'>string</span> xdebug.gc_stats_output_dir = <span class='default'>/tmp</span> <a href='garbage_collection.html#gc_stats_output_dir'>#</a></h4>

	<p>Introduced in <span class='type'>Xdebug >= 2.6</span></p>	
	<div class='description'>The directory where the garbage collection statistics output will be written to, make sure that
the user who the PHP will be running as has write permissions to that
directory. This setting can not be set in your script with ini_set().</div>
</div>
							<hr>
				<div class="doc_setting">
	<a name='gc_stats_output_name'></a>
	<a name='xdebug.gc_stats_output_name'></a>
	<h4><span class='type'>string</span> xdebug.gc_stats_output_name = <span class='default'>gcstats.%p</span> <a href='garbage_collection.html#gc_stats_output_name'>#</a></h4>

	<p>Introduced in <span class='type'>Xdebug >= 2.6</span></p>	
	<div class='description'><p>This setting determines the name of the file that is used to dump
garbage collection statistics into. The setting specifies the format with format specifiers, very
similar to sprintf() and strftime(). There are several format specifiers
that can be used to format the file name.</p>

<p>See the <a href="all_settings.html#trace_output_name">xdebug.trace_output_name</a> documentation for the supported
specifiers.</p>
</div>
</div>
					</div>
	
	<a name='functions'></a>
			<div class='functions'>
			<h3>Functions</h3>

							<hr>
				<div class="doc_function">
	<a name='xdebug_get_gc_run_count'></a>
	<h3 class="name">
					xdebug_get_gc_run_count()
				<span class='type'> : int</span>
		<a href='garbage_collection.html#xdebug_get_gc_run_count'>#</a>
	</h3>

	<div class='short-description'><p>Returns the number of garbage collection runs that have been triggered so far</p></div>

	
	<div class='description'><p>
The function returns the number of times the garbage collection has
 been triggered in the currently running script.
 

</p><p>
This number is available even if the <a href="all_settings.html#gc_stats_enable">xdebug.gc_stats_enable</a> INI setting is set to false.

</p></div>
</div>
							<hr>
				<div class="doc_function">
	<a name='xdebug_get_gc_total_collected_roots'></a>
	<h3 class="name">
					xdebug_get_gc_total_collected_roots()
				<span class='type'> : int</span>
		<a href='garbage_collection.html#xdebug_get_gc_total_collected_roots'>#</a>
	</h3>

	<div class='short-description'><p>Returns the number of variable roots that have been collected so far</p></div>

	
	<div class='description'><p>
The function returns the number of variable roots that the garbage collection has
 collected during all runs of the garbage collector in the current script.
 

</p><p>
This number is available even if the <a href="all_settings.html#gc_stats_enable">xdebug.gc_stats_enable</a> INI setting is set to false.

</p></div>
</div>
							<hr>
				<div class="doc_function">
	<a name='xdebug_get_gcstats_filename'></a>
	<h3 class="name">
					xdebug_get_gcstats_filename()
				<span class='type'> : mixed</span>
		<a href='garbage_collection.html#xdebug_get_gcstats_filename'>#</a>
	</h3>

	<div class='short-description'><p>Returns the garbage collection statistics filename</p></div>

	
	<div class='description'><p>
Returns the name of the file which is used to save garbage collection
 information to, or <code>false</code> if statistics collection is not active.

</p></div>
</div>
							<hr>
				<div class="doc_function">
	<a name='xdebug_start_gcstats'></a>
	<h3 class="name">
					xdebug_start_gcstats( <span class='type'>?string $gcstatsFile = null</span> )
				<span class='type'> : mixed</span>
		<a href='garbage_collection.html#xdebug_start_gcstats'>#</a>
	</h3>

	<div class='short-description'><p>Start the collection of garbage collection statistics</p></div>

	
	<div class='description'><p>
Start tracing garbage collection attempts from this point to the file in the
 <i>gcstatsFile</i> parameter. If no filename is given, then garbage collection stats file
 will be placed in the directory as configured by the <a href="all_settings.html#gc_stats_output_dir">xdebug.gc_stats_output_dir</a> setting.
 

</p><p>
In case a file name is given as first parameter, the name is relative
 to the current working directory. This current working directory might be
 different than you expect it to be, so please use an absolute path in case you
 specify a file name. Use the PHP function <a
 href='http://php.net/getcwd'>getcwd()</a> to figure out what the current
 working directory is.
 

</p><p>
If <a href="all_settings.html#gc_stats_enable">xdebug.gc_stats_enable</a> is
 enabled, then filename depends on the <a href="all_settings.html#gc_stats_output_name">xdebug.gc_stats_output_name</a> setting.
 

</p><p>
The full path and filename to which Xdebug collects statistics into is returned from this
 function. This will be either the filename you pass in, or the auto generated filename if no
 filename has been passed in.

</p></div>
</div>
							<hr>
				<div class="doc_function">
	<a name='xdebug_stop_gcstats'></a>
	<h3 class="name">
					xdebug_stop_gcstats()
				<span class='type'> : string</span>
		<a href='garbage_collection.html#xdebug_stop_gcstats'>#</a>
	</h3>

	<div class='short-description'><p>Stops the current garbage collection statistics collection</p></div>

	
	<div class='description'><p>
Stop garbage collection statistics collection and closes the output file.
 

</p><p>
The function returns the filename of the file where the statistics were written to.

</p></div>
</div>
					</div>
	</div>


</main>


	<footer class="content_width">
		<p>
		This site and all of its contents are Copyright &copy; 2002-2020 by Derick Rethans.<br />
		All rights reserved.
		</p>
	</footer>
</body>
</html>
